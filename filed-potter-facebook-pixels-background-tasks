FROM tiangolo/uwsgi-nginx-flask:python3.7 AS build
RUN apt-get update && apt-get install -y unixodbc-dev

FROM build

ARG STAGE
ENV LISTEN_PORT 47251
EXPOSE 47251
ENV PYTHON_SOLUTION_PATH=''
ENV PYTHON_ENV=${STAGE}
ENV UWSGI_INI /app/Potter/FacebookPixels/BackgroundTasks/uwsgi.ini

COPY ./Potter /app/Potter
COPY ./Core /app/Core
COPY ./requirements.txt /app/Potter/FacebookPixels/BackgroundTasks

WORKDIR /app/Potter/FacebookPixels/BackgroundTasks
RUN pip install --upgrade pip && pip3 install -r requirements.txt